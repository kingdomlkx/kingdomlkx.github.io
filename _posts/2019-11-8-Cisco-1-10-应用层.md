---
title: Cisco-1-10 应用层
auther: 雁引愁心去
layout: post
order: 10
---


## 第十章 应用层 ##





### 第一节 应用层协议 ###

1. 表示层和会话层    

  - 表示层   
  表示层具有三个主要功能:    
    - 将来自源设备的数据格式化或表示成兼容形式，以便目的设备接收
    - 采用可被目的设备解压缩的方式对数据进行压缩
    - 加密数据以便传输，并在接收时解密      
    如图所示，表示层为应用层格式化数据并制定文件格式标准。常见的视频标准包括 QuickTime 和活动图像专家组 (MPEG)。网络中使用的常见图形图像格式为图形交换格式 (GIF)、联合图像专家组 (JPEG) 和便携式网络图像 (PNG) 格式。    

  - 会话层   
  顾名思义，会话层的功能就是创建并维护源应用程序和目的应用程序之间的对话。会话层用于处理信息交换，发起对话并使其处于活动状态，并在对话中断或长时间处于空闲状态时重启会话。    

2. TCP/IP应用层协议    
![10-OSI应用层.png](/assets/images/cisco1/10-OSI应用层.png)
  - DNS - 域名系统 - TCP,UDP 53
  - BOOTP - 引导程序协议 - UDP客户端 68,服务器 67.
  - DHCP - 动态主机配置协议 - UDP 客户端 68 ,服务器 67.
  - SMTP - 简单邮件传输协议 - TCP 25.
  - POP - 邮局协议 - TCP 110.
  - IMAP - 互联网协议访问协议 - TCP 143.
  - FTP - 文本传输协议 - TCP 20-21.
  - TFTP - 简单文件传输协议 - UDP 69.
  - HTTP - 超文本传输协议 - TCP 80 8080.
  - HTTPS - 安全超文本传输协议 - TCP UDP 443.

3. 客户端服务器模式 CS

  在客户端-服务器模型中，请求信息的设备称为客户端，而响应请求的设备称为服务器。客户端进程和服务器进程都处于应用层。客户端首先向服务器发送数据请求，服务器通过发送一个或多个数据流来响应客户端。应用层协议规定了客户端和服务器之间请求和响应的格式。除了实际数据传输外，数据交换过程还要求用户身份验证以及要传输的数据文件的标识

2. 对等 P2P

  在对等 (P2P) 网络模式中，可以从对等设备访问数据，而无需使用专用服务器。

  P2P 网络模型包含两个部分：P2P 网络和 P2P 应用程序。这两个部分具有相似的特征，但实际工作过程却大不相同。

    - 对等网络 - 在 P2P 网络中，两台或多台计算机通过网络互连，它们共享资源(如打印机和文件)时可以不借助专用服务器。每台接入的终端设备（称为“对等点”）既可以作为服务器，也可以作为客户端。在某项事务中，作为服务器的计算机也可以同时成为其他服务器的客户端。于是，计算机的角色根据请求的不同在客户端和服务器之间切换。

    - 对等应用程序    
    如图所示，对等 (P2P) 应用程序允许设备在同一通信中同时充当客户端和服务器。在该模型中，每台客户端都是服务器，而每台服务器也同时是客户端。P2P 应用程序要求每台终端设备提供用户界面并运行后台服务。   
    某些 P2P 应用程序中采用混合系统，即共享的资源是分散的，但指向资源位置的索引存储在集中目录中。在混合系统中，每台对等设备通过访问索引服务器获取存储在另一台对等设备中的资源位置。      

3. 常见P2P应用程序    

  使用 P2P 应用程序时，网络中运行该应用程序的每台计算机都可以充当在网络中运行该应用程序的其他计算机的客户端或服务器。常见 P2P 网络包括:
    - eDonkey
    - G2
    - BitTorrent
    - Bitcoin

  某些 P2P 应用程序基于 Gnutella 协议，允许每个用户与他人共享整个文件。通过与 Gnutella 协议兼容的客户端软件，用户可以在 Internet 上连接 Gnutella 服务，然后定位并访问由其他 Gnutella 对等设备共享的资源。很多 Gnutella 客户端应用程序可用，包括 gtk-gnutella、WireShare、Shareaza 和 Bearshare。

  许多 P2P 应用程序允许用户同时相互分享许多文件片段。客户端使用一个称作 torrent 文件的小型文件查找其他拥有其所需片段的用户，以便可以直接连接到他们。此文件也包含有关跟踪哪些用户有哪些文件的跟踪计算机的信息。客户端同时需要多个用户的文件片段，这被称为集群。该技术称为 BitTorrent。有许多 BitTorren 客户端，包括 BitTorrent、uTorrent、Frostwire 和 qBittorrent。

### 第二节 常用应用层协议和服务 ###

1. 超文本传输协议和超文本标记语言

  当在 Web 浏览器中输入一个 Web 地址或 __统一资源定位符 (URL)__ 时，Web 浏览器将通过 HTTP 协议建立与服务器上的 Web 服务之间的连接。   

  浏览器对 URL 地址的三个组成部分进行分析：   
    - 1.http（协议或方案）
    - 2.www.cisco.com（服务器名称）
    - 3.index.html（所要请求的文件名称）

  浏览器将通过域名服务器将 www.cisco.com 转换成数字 IP 地址，用它连接到该服务器。根据 HTTP 协议的要求，浏览器向该服务器发送 GET 请求并请求 index.html 文件。服务器将该网页的 HTML 代码发送到浏览器。最后，浏览器解密 HTML 代码并为浏览器窗口格式化页面。

2. HTTP 和 HTTPS   

  HTTP 是一种请求/响应协议。当客户端，尤其是 Web 浏览器，发送请求到 Web 服务器时，HTTP 将指定用于该通信的消息类型。常用的三种消息类型包括 GET、POST 和 PUT。
    - GET - 一种客户端数据请求消息。客户端（Web 浏览器）向 Web 服务器发送 GET 消息以请求 HTML 页面。
    - POST - 上传数据文件到 Web 服务器，例如表单数据。
    - PUT - 用于向 Web 服务器上传资源或内容，例如图像。

  尽管 HTTP 灵活性相当高，但它不是一个安全协议。由于请求消息以明文形式向服务器发送信息，它非常容易被拦截和解读。服务器的响应（尤其是 HTML 页面）也不加密。

  为了在 Internet 中进行安全通信，人们使用 HTTP 安全（HTTPS）协议。HTTPS 借助身份验证和加密来保护数据，使数据得以安全地在客户端与服务器之间传输。HTTPS 使用的客户端请求服务器响应过程与 HTTP 相同，但在数据流通过网络传输以前会使用 __安全套接字层 (SSL) 加密__。

3. 电子邮件协议   

  电子邮件客户端通过与邮件服务器通信来收发电子邮件。邮件服务器之间也会互相通信，以便将邮件从一个域发到另一个域中。也就是说，发送电子邮件时，电子邮件客户端并不会直接与另外一个电子邮件客户端通信。而是双方客户端均依靠邮件服务器来传输邮件。

  电子邮件支持三种单独的协议以实现操作：简单邮件传输协议 (SMTP)、邮局协议 (POP) 和 Internet 邮件访问协议 (IMAP)。发送邮件的应用层进程会使用 SMTP。但是，客户端会使用以下两种应用层协议之一来检索电子邮件：POP 或 IMAP。

4. SMTP工作原理   

  SMTP 邮件格式要求邮件具有报头和正文。邮件正文没有长度限制，但邮件报头必须具有格式正确的收件人电子邮件地址和发件人地址。

  当客户端发送电子邮件时，客户端 SMTP 进程会连接公认端口 25 上的服务器 SMTP 进程。连接建立后，客户端将尝试通过此连接发送电子邮件到服务器。服务器收到邮件后，如果收件人在本地，它会将邮件保存在本地帐户中，或者将邮件转发给另一台邮件服务器以便传输。

  发出电子邮件时，目的电子邮件服务器可能并不在线，或者正忙。因此，SMTP 将邮件转到后台处理，稍后再发送。服务器会定期检查邮件队列，然后尝试再次发送。经过预定义的过期时间后，如果仍然无法发送邮件，则会将其作为无法投递的邮件退回给发件人。

5. POP工作原理    

  应用程序使用 POP 从邮件服务器中检索邮件。根据 POP 的规定，邮件将从服务器下载到客户端，然后从服务器上删除。这就是默认情况下 POP 的运行方式。

  服务器通过在 TCP 端口 110 上被动侦听客户端连接请求来启动 POP 服务。当客户端要使用此服务时，它会发送一个请求来建立与服务器的 TCP 连接。一旦建立连接，POP 服务器即会发送问候语。然后客户端和 POP 服务器会交换命令和响应，直到连接关闭或中止。

  根据 POP，由于电子邮件会下载到客户端并从服务器删除，因此电子邮件不会集中保存在某一特定的位置。因为 POP 不会存储邮件，因此不适于需要集中备份解决方案的小型企业。

6. IMAP 工作原理    

  IMAP 是另外一种用于检索电子邮件消息的协议。与 POP 不同的是，当用户连接使用 IMAP 的服务器时，邮件的副本会下载到客户端应用程序。同时原始邮件会一直保留在服务器上，直到用户将它们手动删除。用户在自己的电子邮件客户端软件中查看邮件副本。

  用户可以在服务器上创建文件层次结构来组织和保存邮件。该文件结构会照搬到电子邮件客户端。当用户决定删除邮件时，服务器会同步该操作，从服务器上删除对应的邮件。

7. 域名系统

  DNS 协议定义了一套自动化服务，该服务将资源名称与所需的数字网络地址匹配。协议涵盖了查询格式、响应格式及数据格式。DNS 协议通信采用单一格式，即消息格式。该格式用于所有类型的客户端查询和服务器响应、报错消息、以及服务器间的资源记录信息的传输。

    - DNS 消息格式    

    DNS 服务器中存储不同类型的资源记录，用来解析域名。这些记录中包含域名、地址以及记录的类型。这些记录中有以下类型：
      - A - 终端设备 IPv4 地址
      - NS - 权威域名服务器
      - AAAA - 终端设备 IPv6 地址（读作“四 A”）  
      - MX - 邮件交换记录   

    在客户端进行查询时，服务器的 DNS 进程首先会查看自己的记录以解析名称。如果服务器不能通过自身存储的记录解析域名，它将联系其他服务器对该域名进行解析。在检索到匹配信息并将其返回到原始请求服务器后，服务器临时存储数字地址，以供再次请求同一域名时使用。

    - DNS 层级    
    ![10-DNS层级.png](/assets/images/cisco1/10-DNS层级.png)
    DNS 协议采用分层系统创建数据库以提供名称解析。就像一棵倒置的树的层次结构下到达根的以下顶部和分支机构。DNS 使用域名来划分层次

    域名结构被划分为多个更小的受管域。每台 DNS 服务器维护着特定的数据库文件，而且只负责管理 DNS 结构中那一小部分的“域名-IP”映射。当 DNS 服务器收到的域名转换请求不属于其所负责的 DNS 区域时，该 DNS 服务器可将请求转发到与该请求对应的区域中的 DNS 服务器进行转换。

    - nslookup    

    使用操作系统中名为 nslookup 的实用程序手动查询域名服务器，来解析给定的主机名。该实用程序也可以用于检修域名解析的故障，以及验证域名服务器的当前状态。

    发出 nslookup 命令后，即显示为主机配置的默认 DNS 服务器。可以在 nslookup 提示符下输入主机名或域名。也可以直接输入 nslookup [域名].例如:nslookup www.cisco.com

8. 动态主机配置协议
![10-动态主机配置协议.png](/assets/images/cisco1/10-动态主机配置协议.png)
  IPv4 服务的动态主机配置协议 (DHCP) 会自动分配 IPv4 地址、子网掩码、网关以及其他 IPv4 网络参数。这称为动态编址。动态编址的替代选项是静态编址。在使用静态编址时，网络管理员在主机上手动输入 IP 地址信息。

  主机连入网络时，将联系 DHCP 服务器并请求地址。DHCP 服务器从已配置地址范围（也称为“地址池”）中选择一条地址，并将其分配（租赁）给主机。

  在较大型的网络中，或者用户经常变更的网络中，地址分配优先选用 DHCP。新用户可能在到达时需要连接；其他用户可能必须连接新计算机。与为每个连接使用静态编址的做法相比，采用 DHCP 自动分配 IPv4 地址的方法更有效。

  DHCP 分配的地址租赁一段时间。租赁期限一到，切断主机电源或断开网络，地址便返回地址池以供重新使用。因此，用户可以通过 DHCP 自由换位，并随时重新连接网络。

  IPv4 服务的动态主机配置协议 (DHCP) 会自动分配 IPv4 地址、子网掩码、网关以及其他 IPv4 网络参数。这称为动态编址。动态编址的替代选项是静态编址。在使用静态编址时，网络管理员在主机上手动输入 IP 地址信息。

  主机连入网络时，将联系 DHCP 服务器并请求地址。DHCP 服务器从已配置地址范围（也称为“地址池”）中选择一条地址，并将其分配（租赁）给主机。

  在较大型的网络中，或者用户经常变更的网络中，地址分配优先选用 DHCP。新用户可能在到达时需要连接；其他用户可能必须连接新计算机。与为每个连接使用静态编址的做法相比，采用 DHCP 自动分配 IPv4 地址的方法更有效。

  DHCP 分配的地址租赁一段时间。租赁期限一到，切断主机电源或断开网络，地址便返回地址池以供重新使用。因此，用户可以通过 DHCP 自由换位，并随时重新连接网络。

    - DHCP工作原理    

    如图所示，配置了 DHCP 的 IPv4 设备在启动或连接到网络时，客户端将广播一条 __DHCP 发现 (DHCPDISCOVER) 消息__ 以确定网络上是否有可用 DHCP 服务器。DHCP 服务器 __回复 DHCP 服务 (DHCPOFFER) 消息__，为客户端提供租赁服务。该 _服务消息包含为其分配的 IPv4 地址和子网掩码、DNS 服务器的 IPv4 地址和默认网关的 IPv4 地址_。租赁服务还包括租用期限。

    如果本地网络中有超过一台 DHCP 服务器，客户端可能会收到 __多条 DHCPOFFER 消息__。此时，客户端必须在这些服务器中进行选择，并且将包含服务器标识信息及客户端所接受的租赁服务的 __DHCP 请求 (DHCPREQUEST) 消息__ 发送出去。客户端还可选择向服务器请求分配以前分配过的地址。

    如果客户端请求的 IPv4 地址（或者服务器提供的 IPv4 地址）仍然可用，服务器将返回 __DHCP 确认 (DHCPACK) 消息__，向客户端确认地址租赁。如果请求的地址不再有效，则所选服务器将回复一条 __DHCP 否定确认 (DHCPNAK) 消息__ 。一旦返回 DHCP NAK 消息，应 _重新启动选择进程，并重新发送新的 DHCP 发现消息_。客户端租赁到地址后，应在租期结束前发送 DHCPREQUEST 消息进行续期。

    DHCP 服务器确保每个 IP 地址都是唯一的（一个 IP 地址不能同时分配到不同的网络设备上）。因此，大多数 Internet 提供商往往使用 DHCP 为其客户分配地址。

    DHCPv6 有一组与如图所示 IPv4 的 DHCP 类似的消息。DHCPv6 消息是 SOLICIT、ADVERTISE、INFORMATION REQUEST 和 REPLY

9. 文本传输协议

  文件传输协议 (FTP) 也是一种常用的应用层协议。FTP 用于客户端和服务器之间的数据传输。FTP 客户端是一种在计算机上运行的应用，用于从 FTP 服务器中收发数据。   

  为了成功传输数据，FTP 要求客户端和服务器之间建立两个连接，一个用于命令和应答，另一个用于实际文件传输：
    - 客户端使用 TCP 端口 21 与服务器建立第一个连接用于控制流量，包含客户端命令和服务器应答。
    - 客户端使用 TCP 端口 20 与服务器建立第二个连接用于实际数据传输。每当有数据需要传输时都会建立此连接。

10. 服务器消息块(SMB)

  服务器消息块 (SMB) 是一种客户端/服务器文件共享协议，用于规范共享网络资源（如目录、文件、打印机以及串行端口）结构。这是一种请求-响应协议。所有的 SMB 消息都采用一种常用格式。该格式采用固定大小的文件头，后跟可变大小的参数以及数据组件。

  SMB 消息可以：
    - 启动、身份验证以及终止会话
    - 控制文件和打印机的访问
    - 允许应用程序向任何设备收发消息

  与 FTP 协议支持的文件共享不同，SMB 协议中的客户端要与服务器建立长期连接。一旦建立连接，客户端用户就可以访问服务器上的资源，就如同资源位于客户端主机上一样。
