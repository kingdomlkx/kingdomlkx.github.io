---
title: Cisco-1-8 对IP网络划分子网
auther: 雁引愁心去
layout: post
---

## 第八章 对IP网络划分子网 ##









原始 IPv4 地址中有两级分层结构：网络和主机。这两级编址可以提供基础网络分组，便于将数据包路由到目的网络。路由器根据 IP 地址的网络部分转发数据包。一旦确定了网络位置，则地址的主机部分就可以标识目的设备。   
但是，随着网络不断扩大，许多组织将数百甚至数千台主机添加到其网络中，两级分层结构就显得不足。    
将网络细分，在网络分层结构中添加一个级别，实际上是创建三个级别：网络、子网和主机。分层结构中另一级别的引入在 IP 网络中创建了额外的子分组，使数据传输更快并且通过帮助最小化“本地”流量增加了过滤。   

### 第一节 对IPv4网络划分子网 ###
1. 广播域    
在以太网 LAN 中，设备使用广播进行定位：    
  - 其他设备 – 设备使用地址解析协议 (ARP) 将第 2 层广播发送到本地网络上的已知 IPv4 地址，以发现相关 MAC 地址。
  - 服务 – 主机通常需要使用动态主机配置协议 (DHCP) 来获取 IPv4 地址配置，这会发送本地网络上的广播来定位 DHCP 服务器。
交换机会将广播传播到所有接口，接收广播的接口除外.
路由器不传播广播。路由器在收到广播时，它不会将其转发到其他接口。例如，当 R1 在其 Gigabit Ethernet 0/0 接口收到广播时，它不会将其转发到另一个接口。因此，各路由器接口连接 广播域 ，广播的传播范围仅限于特定广播域内.
2. 大型广播域问题          
大型广播域是连接很多主机的网络。大型广播域的一个问题是这些主机会生成太多广播，这会对网络造成不良影响。   
解决方案是使用称为 “子网划分”的过程缩减网络的规模以创建更小的广播域。.这些较小的网络空间通常称为 子网.    
例如，网络地址为 __172.16.0.0 /16__ 的 LAN 1 中的 400 个用户被划分到两个子网中，每个子网包含 200 个用户，网络地址分别为 __172.16.0.0 /24 和 172.16.1.0 /24__。广播仅在更小的网络域内传播。因此，LAN 1 中的广播不会传播到 LAN 2。
注意,意，前缀长度如何从 16 变为 24。这是基本的子网划分；使用主机位可以创建其他子网。
3. 八位组边界    
路由器上的每个接口都会连接到网络。在路由器接口上配置的 IPv4 地址和子网掩码用于确定特定广播域。记住，前缀长度和子网掩码是识别地址网络部分的不同方法。创建 IPv4 子网时会将一个或多个主机位作为网络位。具体做法是延长子网掩码，从地址的主机部分借用若干位来增加网络位。借用的主机位越多，可以定义的子网也就越多。
4. 二进制八位数边界上的子网划分   
5. 无类子网划分   
目前的示例中都从常见的 /8、/16 和 /24 网络前缀借用了主机位。但是，子网可从 any 主机位位置借位以创建其他掩码。   
例如:
/25 行 - 从第 4 个二进制八位数借用 1 位可以创建每个能容纳 126 个主机的 2 个子网。
/26 行 - 借用 2 位可以创建每个能容纳 62 个主机的 4 个子网。
/27 行 - 借用 3 位可以创建每个能容纳 30 个主机的 8 个子网。
/28 行 - 借用 4 位可以创建每个能容纳 14 个主机的 16 个子网。
/29 行 - 借用 5 位可以创建每个能容纳 6 个主机的 32 个子网。
/30 行 - 借用 6 位可以创建每个能容纳 2 个主机的 64 个子网。
例如:     
考虑私有网络地址 192.168.1.0/24     
子网掩码是 255.255.255.0，如 /24 前缀长度所示。   
从主机部分最重要的位（最左边的位）借用 1 位，从而将网络部分扩展为 25 位或 /25。这能创建两个子网.     
192.168.1.00000000 /25 (192.168.1.0/25)
192.168.1.10000000 /25 (192.168.1.128/25)
子网掩码都为 255.255.255.128 或 /25    
6. 创建两个子网   
R1 的两个 LAN 网段连接到其千兆以太网接口。每个 LAN 分配有一个子网。    
  - 第一个子网
    - IPv4 网络地址是 192.168.1.0，且包含该地址的主机部分的全部 0 位
    - 第一个 IPv4 主机地址是 192.168.1.1，且包含全部 0 位加上该地址的主机部分最右边的 1 位。
    - 最后一个 IPv4 主机地址是 192.168.1.126，且包含全部 1 位加上该地址的主机部分最右边的 0 位
    - IPv4 广播地址是 192.168.1.127 且包含该地址的主机部分的全部 1 位
  - 第二个子网   
    - IPv4 网络地址是 192.168.1.128，且包含该地址的主机部分的全部 0 位
    - 第一个 IPv4 主机地址是 192.168.1.129，且包含全部 0 位加上该地址的主机部分最右边的 1 位
    - 最后一个 IPv4 主机地址是 192.168.1.254，且包含全部 1 位加上该地址的主机部分最右边的 0 位
    - IPv4 广播地址是 192.168.1.255 且包含该地址的主机部分的全部 1 位   
  路由器接口必须在分配的子网的有效主机范围内分配 IP 地址。网络上的主机会将该地址用作其默认网关。一般将网络范围内的第一个或最后一个可用地址用作路由器接口地址.
7. 传统子网划分浪费地址   
所有子网都使用相同的子网掩码。这意味着每个子网有相同数量的可用主机地址。
8. 可变长子网掩码    
使用 VLSM，子网掩码将根据特定子网所借用的位数而变化，从而成为 VLSM 的“变量”部分。   
VLSM 子网划分与传统子网划分类似，通过借用位来创建子网。用于计算每个子网主机数量和所创建子网数量的公式仍然适用。    
区别在于，子网划分不再是可以一次完成的活动。使用 VLSM 时，首先对网络划分子网，然后对子网再进行子网划分。该过程可以多次重复，以创建不同大小的子网。       
注意：当使用 VLSM 时，请始终从满足最大子网的主机要求开始。继续子网划分直至满足最小子网的主机要求。    
9. 基本VLSM   

![8-基本VLSM-网络拓扑.png](/assets/images/cisco1/8-基本VLSM-网络拓扑.png)
![8-基本VLSM-VLSM子网划分方案.png](/assets/images/cisco1/8-基本VLSM-VLSM子网划分方案.png)

网络 192.168.20.0/24 会通过子网划分进一步分为 8 个规模相等的子网。会分配 8 个子网中的 7 个。其中四个子网用于 LAN，三个子网用于路由器之间的 WAN 连接。回想一下，用于 WAN 连接的子网会浪费地址空间，因为这些子网只需要两个可用地址：每个路由器接口使用一个。为了避免这种浪费，可以使用 VLSM 为 WAN 连接创建较小子网。   
![8-VLSM图表.png](/assets/images/cisco1/8-VLSM图表.png)
![8-基本VLSM-VLSM子网划分方案.png](/assets/images/cisco1/8-基本VLSM-VLSM子网划分方案.png)

为了为 WAN 链路创建较小子网，将其中一个子网细分。在本示例中，对最后一个子网 192.168.20.224/27 进一步划分子网。   
因为划分子网的 192.168.20.224/27 地址空间有 5 个主机位，所以可以借用 3 个位，在主机部分保留 2 个位，此时的计算与传统子网划分使用的计算完全相同。借用了位，并确定了子网范围。    
这种 VLSM 子网划分方案将每个子网的地址数目减少到适合 WAN 的大小。对 WAN 的子网 7 划分子网，使子网 4、5 和 6 能够用于未来网络，而且 WAN 中能够有 5 个额外的子网可用。     

### 第二节 编制方案 ###
网络子网的规划要求同时分析组织的网络使用需求和子网的构建方法。进行网络需求调研是子网规划的起点。这意味着要查看整个网络，并确定网络的主要部分和划分方法。地址规划包括确定 __每个子网对于子网大小__、__每个子网中的主机数__、__主机地址的分配方法__、__哪些主机要求静态 IPv4 地址__ 和 __哪些主机可以使用 DHCP 获取其编址信息__ 的需求。     
请记住，私有 IPv4 地址的范围是：
  - 10.0.0.0 - 10.255.255.255，子网掩码为 255.0.0.0 或 /8
  - 172.16.0.0 – 172.31.255.255，子网掩码为 255.240.0.0 或 /12
  - 192.168.0.0 – 192.168.255.255，子网掩码为 255.255.0.0 或 /16
1. 规划网络地址分配   
  - 防止地址重复
  - 提供和控制访问
  - 监视主机的安全性能
2. 为设备分配地址    
在一个网络中，有不同类型的设备需要分配地址，包括：   
  - 终端用户客户端 – 大部分网络使用动态主机配置协议 (DHCP) 动态分配地址。这能减少网络支持人员的负担，并显著减少输入错误。    
  - 服务器和外围设备 – 这些应具有可预测的静态 IP 地址。对这些设备使用统一的编号系统。    
  - 可从互联网访问的服务器 – 在许多网络中，服务器必须能让远程用户访问。在大多数情况下，这些服务器在内部都分配了私有地址，且位于该网络边界的路由器或防火墙必须配置为将内部地址转换为公有地址。  
  - 中间设备 – 这些设备出于网络管理、监视和安全目的分配了地址。因为我们必须知道如何与中间设备通信，所以它们应当具有可以预测的静态地址。
  - 网关 - 路由器和防火墙设备给每个接口分配一个 IP 地址，用作该网络中主机的网关。路由器接口一般使用网络中的最小地址或最大地址。

### 第三节 IPv6注意事项 ###
1. IPv6 全局单播地址    
IPv6 子网划分要求使用与 IPv4 子网划分不同的方法。对 IPv4 地址空间进行子网划分以管理网络流量的原因同样也适用于 IPv6。但是，由于 IPv6 地址的数量庞大，不再有保留地址的忧虑。IPv6 地址规划可以关注最好的分层方法来管理和分配 IPv6 子网.        
IPv4 子网划分不仅在于限制广播域，还在于管理地址稀缺性。确定子网掩码并使用 VLSM 来帮助保留 IPv4 地址。IPv6 子网划分不需要关注保留地址空间。子网 ID 包括足够多的子网。IPv6 子网划分根据所需子网数构建寻址层次结构。    
回想一下，有两种类型的可分配 IPv6 地址。IPv6 本地链路地址永远不会进行子网划分，因为它仅存在于本地链路中。但是，IPv6 全局单播地址可以进行子网划分。     
IPv6 全局单播地址一般由一个 /48 全局路由前缀、一个 16 位子网 ID 和一个 64 位接口 ID 组成。    
2. 使用子网ID划分子网     
IPv6 子网划分也比 IPv4 容易实施，因为不需要转换为二进制。要确定下一个可用子网，只需要将十六进制数相加。   
