---
title: Cisco-1-11 构建小型网络
auther: 雁引愁心去
layout: post
---


## 第十一章 构建小型网络 ##







### 第一节 网络设计 ###

1. 小型网络的设备选择    
  - 成本
  - 端口/接口的速度和类别
  - 可扩展性
  - 操作系统的功能和服务      
  根据操作系统的版本，网络设备可以支持特定的功能和服务，例如：     
    - 安全
    - 服务质量 (QoS)
    - IP 语音 (VoIP)
    - 第 3 层交换
    - 网络地址转换 (NAT)
    - 动态主机配置协议 (DHCP)

2. 小型网络的 IP 编址      

  在实施小型网络时，需要规划 IP 编址空间。网际网络中的所有主机都必须有一个唯一地址。应当根据接收地址的设备类型规划、记录和维护 IP 编址方案。

  IP 编址方案的规划和记录可以帮助管理员跟踪设备类型。例如，如果为所有服务器分配的主机地址范围为 50-100，则很容易通过 IP 地址来识别服务器流量。这在使用协议分析器对网络流量问题进行故障排除时非常有用。

  此外，当使用确定性 IP 编址方案时，管理员可以根据 IP 地址更好地控制对网络资源的访问。这对于同时向内部网络和外部网络提供资源的主机尤为重要。Web 服务器或电子商务服务器扮演这样的角色。如果不规划和记录这些资源的地址，就不容易控制设备的安全和访问。如果一台服务器的地址是随机分配的，就难以阻止对此地址的访问，客户端可能也就无法定位此资源。

3. 小型网络中的冗余     

  网络设计的另一个重要部分是可靠性。即使是小型企业，也常常非常依赖其网络以进行企业运营。网络故障的代价是非常大的。为了保持高可靠度，网络设计中要求冗余。冗余有助于避免单点故障。在网络中实现冗余有许多方法。可以通过安装重复设备实现冗余，但也可以通过为关键区域提供重复的网络链路来实现，如图所示。


4. 流量管理   

  网络管理员应当考虑网络设计中的各种流量类型及其处理。应当对小型网络中的路由器和交换机进行配置，使其使用与支持其他数据流量不同的方式支持实时流量，例如语音和视频。事实上，一个好的网络设计会根据优先级仔细对流量进行分类，

5. 常见应用程序     

  - 网络应用程序    

    应用程序是指用于网络通信的软件程序。有些终端用户应用程序是网络感知程序，即这些程序实现应用层协议，并可直接与协议栈的较低层通信。电子邮件客户端和 Web 浏览器就属于这种类型的应用程序。

  - 应用层服务       

    其他程序可能需要通过应用层服务使用网络资源，例如文件传输或网络假脱机打印。虽然这些服务对员工而言是透明的，但它们正是负责与网络交互和准备传输数据的程序。无论数据类型是文本、图形还是视频，只要类型不同，就需要与之对应的不同的网络服务，从而确保 OSI 模型的下层能够正确处理数据。                         

    每个应用程序或网络服务使用协议，定义要使用的标准和数据格式。如果没有协议，数据网络将不能使用通用的方式来格式化及引导数据。为了便于理解不同网络服务的功能，我们有必要先熟悉管理这些服务的底层协议。                                     

6. 小型网络增长       

  - 网络文档 - 物理和逻辑拓扑
  - 设备清单 - 使用或构成网络的设备列表
  - 预算 - 逐项记录的 IT 预算，包括财年设备的采购预算
  - 流量分析 - 应当记录协议、应用程序和服务以及它们各自的流量要求

7. 协议分析

  要确定如何管理网络流量，了解网络上传输的流量类型以及当前的传输模式很重要，尤其是在扩展网络时。如果流量类型未知，__协议分析器__ 可帮助确定流量和其来源。

  要确定流量模式，应做好以下几点：        
  - 通过捕获网络使用高峰期的流量准确了解各种不同的流量类型。
  - 针对 __不同的网段__ 捕获流量，因为某些流量仅在特定的网段内传输。       

  协议分析器收集的信息 __根据流量的源和目标以及发送的流量类型__ 进行分析。这种分析有助于决定提高流量管理效率的方法，例如减少不必要的流量，或通过移动某台服务器的逻辑位置来改变流量的总体模式。

  有时，只要简单地将服务器或服务移到另一个网段就能提高网络性能并满足不断增长的流量需求。有时则需要大刀阔斧地进行网络的重新设计并投入巨大的人力才可以优化网络的性能。

### 第二节 网络安全 ###

1. 威胁类型

  - 信息盗窃
  - 身份盗窃
  - 服务中断
  - 数据丢失和操纵

2. 物理安全   

  物理威胁分为四类：
    - 硬件威胁 - 对服务器、路由器、交换机、布线间和工作站的物理破坏
    - 环境威胁 - 指极端温度（过热或过冷）或极端湿度（过湿或过干）
    - 电气威胁 - 电压尖峰、电源电压不足（电力管制）、不合格电源（噪音），以及断电
    - 维护威胁 - 指关键电气组件处理不佳（静电放电）、缺少关键备用组件、布线混乱和标识不明

3. 漏洞类型     

  漏洞是指每个网络和设备固有的薄弱程度。这些设备包括路由器、交换机、台式计算机、服务器，甚至安全设备。一般而言，受到攻击的网络设备都是端点设备，例如服务器和台式计算机。

  漏洞（或称缺陷）主要包括三种类型：
    - 技术
    ![11-漏洞-技术.png](/assets/images/cisco1/11-漏洞-技术.png)

    - 配置
    ![11-漏洞-配置.png](/assets/images/cisco1/11-漏洞-配置.png)

    - 安全策略
    ![11-漏洞-策略.png](/assets/images/cisco1/11-漏洞-策略.png)

    所有这三种漏洞或缺陷都会导致各种攻击，包括恶意代码攻击和网络攻击。

4. 恶意软件的类型      

  - 病毒

    计算机病毒是一种通过将自身副本插入另一个程序并成为其一部分来传播的恶意软件类型。它在计算机之间传播，感染所到之处。病毒从严重程度上来讲包括从导致轻度恼人影响到损坏数据或软件和导致拒绝服务 (DoS) 条件。几乎所有的病毒都是附加到一个可执行文件中，这意味着病毒可能在系统上存在，但在用户运行或打开恶意主机文件或程序前不会处于活跃状态也不会传播。执行主机代码后，也就执行了病毒代码。通常情况下，主机程序在感染了病毒后仍继续运行。但是，一些病毒用其自身副本覆盖其他程序，这就完全破坏了主机程序。当病毒附加的软件或文档通过网络、磁盘、文件共享或被感染的电子邮件附件从一台计算机传输到另一台计算机时，也传播了病毒。

  - 蠕虫

    计算机蠕虫与病毒相似，它们均可复制自身的功能副本，并造成相同类型的损坏。与病毒相比，病毒需要通过感染的主机文件来传播，而蠕虫属于独立软件，无需借助主机程序或人工帮助即可传播。蠕虫不需要附加在程序中来感染主机并通过系统漏洞进入计算机。蠕虫无需帮助便可利用系统功能在网络中传输。

  - 特洛伊木马

    特洛伊木马是另一种类型的恶意软件，以希腊人用来潜入特洛伊的木马来命名。它是看起来合法的的有害软件。用户通常是被骗加载特洛伊木马并在他们的系统上执行。特洛伊木马激活后，可以在主机上进行任意数量的攻击，从激怒用户（弹出窗口或改变桌面）到破坏主机（删除文件、窃取数据或激活和传播病毒等其他恶意软件）。众所周知，特洛伊木马为恶意用户访问系统创建后门。

    不同于病毒和蠕虫，特洛伊木马不通过感染其他文件进行复制，也不自行复制。特洛伊木马必须通过用户交互传播，如打开电子邮件附件或从互联网下载并运行文件。

5. 侦察攻击     

  除了恶意代码攻击外，网络还可能遭受各种网络攻击。网络攻击可分为三大类别：
    - 侦察攻击 - 搜索和映射系统、服务或漏洞

      对于侦察攻击，外部攻击者可以使用互联网工具（如 nslookup 和 whois 实用程序）轻松地确定分配给公司或实体的 IP 地址空间。确定 IP 地址空间后，攻击者可以 ping 这些公有 IP 地址以确定哪些地址正在使用。为帮助自动执行此步骤，攻击者可能会使用 ping 扫描工具，例如 fping 或 gping，系统地向给定范围或子网中的所有网络地址执行 ping 操作。这类似于浏览电话簿的某一部分，拨打其中列出的每个号码，看哪些号码有人接听。

    - 访问攻击 - 数据、系统或用户访问权限的未授权控制

      访问攻击利用身份验证服务、FTP 服务和 Web 服务的已知漏洞，获取对 Web 帐户、机密数据库和其他敏感信息的访问。访问攻击使个人能够对他们无权查阅的信息进行未经授权访问。访问攻击可分为四种类型：
        - 密码攻击
        - 信任利用

        ![11-信任利用示例.png](/assets/images/cisco1/11-信任利用示例.png)
        - 端口重定向

        ![11-端口重定向.png](/assets/images/cisco1/11-端口重定向.png)
        - 中间人

        ![11-中间人.png](/assets/images/cisco1/11-中间人.png)

    - 拒绝服务 - 网络、系统或服务的禁用或损坏

      拒绝服务 (DoS) 攻击是知名度最高的攻击，并且也是最难防范的攻击。即使在攻击者社区中，DoS 攻击也被认为是虽然简单但十分恶劣的方式，因为发起这种攻击非常容易。由于其实施简单、破坏力强大，安全管理员需要特别关注 DoS 攻击。

      DoS 攻击的方式多种多样。不过其目的都是 __通过消耗系统资源使授权用户无法正常使用服务__。
      ![11-Smurf攻击.png](/assets/images/cisco1/11-Smurf攻击.png)
      ![11-SYN泛洪.png](/assets/images/cisco1/11-SYN泛洪.png)

6. 防火墙    

  防火墙是保护用户远离外部威胁的最为有效的安全工具之一。防火墙驻留在两个或多个网络之间，控制其间的流量并帮助阻止未授权的访问。基于主机的防火墙，即个人防火墙，安装在终端系统上。防火墙产品使用多种技术来区分应禁止和应允许的网络访问。这些技术包括：   

    - 数据包过滤 - 根据 IP 或 MAC 地址阻止或允许访问
    - 应用程序过滤 - 根据端口号阻止或允许访问特定类型的应用程序
    - URL 过滤 - 根据特定的 URL 或关键字阻止或允许访问网站
    - 状态包侦测 (SPI) - 传入数据包必须是对内部主机所发出请求的合法响应。除非得到特别允许，否则未经请求的数据包会被拦截。状态包侦测还可具有识别和过滤特定类型攻击，例如拒绝服务 (DoS) 的能力。

7. 对于思科路由器，Cisco AutoSecure 功能可用于协助保护系统         
`R1# auto secure`

8. 基本安全实践   

  - 其他密码安全性   

    强密码只有保持其机密性才是有用的。可以采取几个步骤来帮助确保密码的机密性。如图所示，使用全局配置命令      
    `service password-encryption`                
    防止未经授权的个人在配置文件中查看明文形式的密码。该命令会将所有未加密密码进行加密。        

    此外，为了确保配置的所有密码至少为指定的最小长度，请在全局配置模式下使用        
    `security passwords min-length`命令。      

    `Router(config)# login block-for 120 attempts 3 within 60`      
    这个命令是在 60 秒内有 3 次登录尝试失败时阻止登录尝试 120 秒。        

  - Exec 超时     

    通过设置 Exec 超时，您将告知思科设备在用户闲置时间达到 Exec 超时时间值时自动断开线路上的用户。可以 __在线路配置模式__ 下使用           
    `exec-timeout`            
    命令配置控制台、VTY 和辅助端口上的 Exec 超时。      

    `Router(config)# line vty 0 4`      
    `Router(config-line)# exec-timeout 10`          
    该命令配置设备在 10 分钟后断开空闲用户。      

9. 启动SSH

  Telnet 并不安全。Telnet 数据包中包含的数据以未加密形式传输。因此，强烈建议在设备上启用 SSH 以进行安全远程访问。可以通过四个步骤来配置思科设备以支持 SSH。

    - 第 1 步：确保路由器具有唯一的主机名，然后在全局配置模式下使用         
    `ip domain-name`          
    命令配置网络的 IP 域名。        

    - 第 2 步：必须为路由器生成单向密钥以加密 SSH 流量。要生成 SSH 密钥，请在全局模式下使用           
    `crypto key generate rsa general-keys`               
    确定密钥大小的系数可配置为 360 位至 2048 位。系数越大，密钥就越安全，但加密和解密信息所用的时间也就越长。最小建议系数长度为 1024 位。

    - 第 3 步：使用 username 全局配置命令来创建本地数据库用户名条目。
    `username bob secert cisco`

    - 第 4 步：使用 __线路 vty 命令__ `login local` 和 `transport input ssh` 启用传入 SSH 会话。

### 第三节 基础网络性能 ###

1. 解读 Ping 结果

  使用 ping 命令是测试连接的有效方法。ping 命令使用 __互联网控制消息协议 (ICMP)__，并验证第 3 层的连接。ping 命令并不总能精确确定问题的本质，但可帮助确定问题的来源，这是排除网络故障时重要的第一步。

  - IOS Ping 指示符      
  从 IOS 发出的一个 ping 命令将为发送的每个 ICMP 回应生成一个指示符。最常见的指示符有：     
    - ! - 表示收到一个 ICMP 应答消息，如图 1 所示。
    - .- 表示超时，正在等待 ICMP 应答消息
    - U — 表示收到了一个 ICMP 无法到达报文


  - 测试环回

    ping 命令也可通过对环回地址 127.0.0.1 执行 ping 来验证本地主机上的内部 IP 配置，如图 2 所示。这将验证从网络层到物理层再返回网络层的协议栈是否工作正常，而不会向网络介质发送任何信号。

2. 扩展Ping

  Cisco IOS 提供 ping 命令的“扩展”模式。可通过在特权 EXEC 模式下键入不带目的 IP 地址的 ping 命令来进入此模式。如图所示，会出现一系列的提示符。按 Enter 可接受所指出的默认值。示例说明如何将 ping 命令的源地址强置为 10.1.1.1（参见图中的 R2）；将标准 ping 命令的源地址强置为 209.165.200.226。这样做可以使网络管理员从 R2 上验证 R1 是否有到 10.1.1.0/24 的路由。     
  注意：ping ipv6 命令用于 IPv6 扩展 ping。     
![11-扩展PING.png](/assets/images/cisco1/11-扩展PING.png)

3. 网络基线

  监控网络和排除网络故障的最有效的工具之一就是建立网络基线。创建一条有效的网络性能基线需要一段较长的时间才能完成。在不同时间以及各种负载下测量网络性能有助于建立更准确的网络整体性能概貌。        

  网络命令的输出可为网络基线提供数据。      

  开始基线的方法之一就是将 ping、trace 或其他相关命令的执行结果复制并粘贴到文本文件中。然后为这些文本文件加上时间戳并保存到档案中以备将来检索和比较。需考虑的项目包括错误消息以及主机之间的响应时间。如果响应时间增加较大，则表示可能有延时问题需要解决。

4. 解读跟踪消息     

  追踪可用于返回数据包在网络中传输时沿途经过的跳的列表。该命令的形式取决于发出命令的位置。若从 Windows 计算机上执行追踪，请使用 `tracert`。如图 1 所示，若从路由器 CLI 上执行追踪，请使用 `traceroute`。

    - 扩展 Traceroute     

      作为 traceroute 命令的变体，扩展 traceroute 命令允许管理员对命令操作相关参数作出调整。这对于路由环路问题的故障排除和下一跳路由器的准确确定非常有用，或者可以帮助确定路由器在何处丢弃了数据包或者防火墙在何处拒绝了数据包。

      与 ping 类似，traceroute (tracert) 的 Windows 实现用于发送 __ICMP 回应请求__。与 ping 不同，第一个 IPv4 数据包的 TTL 值为 1。路由器在转发数据包之前将 TTL 值减1。如果 TTL 值递减为零，路由器将丢弃数据包并将 ICMP 超时消息返回给源。每次 traceroute 源收到 ICMP 超时消息时，均会显示 ICMP 超时消息的源 IPv4 地址，将 TTL 递增 1 并发送另一个 ICMP 回应请求。

      思科 IOS 使用一种稍微不同的 traceroute 方法，不使用 ICMP 回应请求。相反，IOS 发出一系列 __UDP 数据报__，各数据报均有递增的 TTL 值和目的端口号。端口号是无效端口号（思科使用默认值 33434），并随 TTL 递增。与 Windows 实现类似，当路由器将 TTL 递减为零时，它会将 ICMP 超时消息返回给源。这会将 IPv4 地址源通知给路径上的各路由器。

      当数据包到达最终目的地时，因为这些数据报试图访问目的主机上的无效端口，所以主机会以指示端口无法访问的 ICMP 类型 3 代码 3 消息予以回应。此事件向 traceroute 源通知 traceroute 程序已到达其目的地。

      要使用扩展 traceroute，无需提供任何参数，直接键入 traceroute，然后按 ENTER。IOS 将会显示一些与各个参数的设置相关的提示，引导您使用命令选项。

      ![11-扩展 traceroute 选项.png](/assets/images/cisco1/11-扩展 traceroute 选项.png)

5. 常用 show 命令回顾

  Cisco IOS CLI show 命令显示有关设备配置和运行的相关信息。

  网络技术人员使用 show 命令广泛用于查看配置文件，检查设备接口和进程的状态并且验证设备运行状态。不管使用 CLI 还是 Cisco Configuration Professional 配置设备，show 命令都可用。

  几乎路由器的每个进程或功能的状态都可使用 show 命令显示出来。比较常用的 show 命令有：    
    - show running-config（图 1）
    - show interfaces（图 2）
    - show arp（图 3）
    - show ip route（图 4）
    - show protocols（图 5）
    - show version（图 6）

6. 主机和IOS命令     
  - ipconfig      

    通过在 Windows 计算机的命令行中发出 ipconfig 命令可以查看主机的默认网关 IP 地址。

    使用 ipconfig /all 命令可查看 MAC 地址和有关设备第 3 层编址的许多细节。

    在安装了 Windows 系统的 PC 上，DNS 客户端服务可以预先在内存中存储已解析的域名，从而优化 DNS 域名解析性能。如图 3 所示，在 Windows 计算机系统中，输入 ipconfig /displaydns 命令可以显示所有 DNS 缓存条目。

  - arp

    arp 命令从 Windows 命令提示符下执行。arp –a 命令列出了当前主机 ARP 缓存中的所有设备，所列出的信息包括每台设备的 IPv4 地址、物理地址和编址类型（静态/动态）。

    当网络管理员要使用更新后的信息重新填充路由器缓存时，可通过使用 arp -d * 命令来清空缓存。

    ARP 缓存仅包含最近访问过的设备的信息。要确保填充 ARP 缓存，请 ping 一台设备以使该设备对应的条目出现在 ARP 表中。

  - `show cdp neighbors` 命令

    思科发现协议 (CDP) 是思科专有协议，在 __数据链路层__ 运行。由于 CDP 在数据链路层运行，即使不存在第 3 层连接，两台或多台思科网络设备（例如支持不同网络层协议的路由器）也可以互相获取信息。

    思科设备启动时会默认启动 CDP。CDP 会自动发现运行 CDP 的邻近思科设备，无论这些设备运行哪种第 3 层协议或协议簇。CDP 还会与直连的 CDP 邻居交换硬件和软件设备信息。

    CDP 提供每台 CDP 邻居设备的以下信息：
      - 设备标识符 - 例如，为交换机配置的主机名
      - 地址列表 - 每种支持的协议最多对应一个网络层地址
      - 端口标识符 -本地和远程端口的名称 － ASCII 字符格式的字符串，例如 FastEthernet 0/0
      - 功能列表 - 例如，该设备是路由器还是交换机
      - 平台 - 设备的硬件平台;例如 Cisco 1841 系列路由器

    show cdp neighbors detail 命令也会显示相邻设备的 IP 地址。无论是否能 ping 通邻居，CDP 都会显示邻居的 IP 地址。当两台 Cisco 路由器无法通过共享的数据链路进行路由时，此命令非常有用。`show cdp neighbors detail` 命令也有助于确定某个 CDP 邻居是否存在 IP 配置错误。

    虽然它和 CDP 同样有用，但它也会带来安全风险，因为它可以为攻击者提供有用的网络基础设施信息。例如，许多 IOS 版本默认情况下会向所有已启用的端口发送 CDP 通告。但是，最佳实践建议仅在连接到其他基础设施思科设备的接口上启用 CDP。应在面向用户的端口上禁用 CDP 通告。

    由于某些 IOS 版本默认情况下会向外发送 CDP 通告，因此必须知道如何禁用 CDP。要全局禁用 CDP，请使用全局配置命令 `no cdp run`。要在某一接口上禁用 CDP，请使用接口命令 `no cdp enable`。

  - `show ip interface brief` 命令            
    用于验证路由器接口和交换机接口工作情况的命令        

7. 调试
  - debug 命令      
    IOS 进程、协议、机制和事件生成消息以告知它们的状态。在排除故障或验证系统操作时，这些消息可以提供有价值的信息.OS debug 命令允许管理员实时显示这些消息，以便进行分析。它是 Cisco IOS 设备中用于监控事件的一个非常重要的工具.

    所有 debug 命令都在特权 EXEC 模式下输入。Cisco IOS 允许缩小 debug 的输出，以便仅包含相关功能或子功能。

    要监控思科路由器中 ICMP 消息的状态，请使用 `debug ip icmp`.

    要关闭特定调试功能，请在 debug 命令前添加关键字 no：`Router# no debug ip icmp`.

    要同时关闭所有活动的 debug 命令，请使用 undebug all 命令：`Router# undebug all`.

    某些 debug 命令（例如 `debug all` 和 `debug ip packet`）会生成大量输出，并使用大量系统资源。路由器会忙于显示 debug 消息，以至于没有足够的处理能力来执行其网络功能，或侦听关闭调试的命令。因此，不建议使用这些命令选项，应尽量避免。

  - terminal monitor 命令

    可在本地或远程建立授权访问 IOS 命令行界面的连接。

    远程连接通过网络建立，因此需要一个网络协议（例如 IP）。远程会话不需要直接物理访问。SSH 和 Telnet 是用于远程会话的两种常见的连接协议。特定远程连接（例如 Telnet 连接或 SSH 连接）时会使用此协议。

    当 IOS 日志消息默认发送到控制台时，这些相同的日志消息默认不会发送到虚拟线路。由于调试消息属于日志消息，此行为会阻止任何与调试相关的消息在 VTY 线路上显示。

    要在终端（虚拟控制台）上显示日志消息，请使用 `terminal monitor` 特权 EXEC 命令。

    要停止终端上的日志记录消息，请使用 `terminal no monitor` 特权 EXEC 命令。

### 第四节 网络故障排除 ###

1. 故障排除方法

  - 故障排除基本方法    
    常用且有效的故障排除方法以科学方法为基础，可分为图中的六个主要步骤。  
    ![11-故障排除方法六个主要步骤.png](/assets/images/cisco1/11-故障排除方法六个主要步骤.png)

  - 验证并监控解决方案   
    Cisco IOS 包含强大工具，可帮助完成故障排除和验证。当问题得以解决、方案得到实施后，系统运行的验证至关重要。验证工具包括 ping、traceroute 和 show 命令。ping 命令可用于验证网络连接是否成功。

    注意：ping 操作失败，通常无法提供足够的信息来得出任何结论。可能是 ACL 或防火墙阻止 ICMP 数据包的结果，也可能是目的设备配置为不对 ping 操作做出响应。ping 操作失败，通常表示需要进一步调查。

    traceroute 命令用于显示数据包到达目的地所采用的路径。ping 命令的输出可显示数据包是否到达目的地，而 traceroute 命令的输出会显示其到达的路径或数据包在路径中的什么位置停止。

    Cisco IOS show 命令是 Cisco IOS 中最有用的一些故障排除和验证工具。show 命令可利用多种不同的选项和子选项缩小和显示有关几乎所有 IOS 特定方面的信息。

2. 排除电缆和接口故障      

  - 双工操作    

    在数据通信中，双工是指两台设备之间数据传输的方向。如果通信限制为每次在一个方向进行数据交换，则此连接称为半双工。全双工允许同时发送和接收数据。

    为了达到最佳通信性能，两个连接的以太网网络接口必须在同一双工模式下运行，以避免低效和链路延迟。

    以太网自动协商旨在简化配置，最大限度地减少问题，并提高链路性能。连接的设备首先通告其支持的功能，然后选择两端所支持的最高性能模式。

    如果两个连接的设备，一个在全双工模式下运行，另一个在半双工模式下运行，就会出现双工不匹配。当数据通过双工不匹配的链路通信时，链路性能就会很差。

  - 双工不匹配

    当设备之间仍在通信时，可能很难对双工不匹配的问题进行排查。即使在使用 ping 等工具时，双工不匹配问题也可能会变得不够明显。单个小的数据包可能无法显示出双工不匹配问题。缓慢发送数据的终端会话（在很短时间内）也可能通过双工不匹配成功通信。即使连接的任意一端尝试大量发送数据并且链路性能显著下降，原因可能也不会很明显，因为网络是正常运行的。

    思科专有协议 CDP 可以很容易地检测到两台思科设备之间的双工不匹配。考虑图 1 中的拓扑和日志消息，其中 R1 的 G0/0 接口错误地配置为在半双工模式下运行。CDP 会显示有关双工不匹配链路的日志消息。消息还包含涉及双工不匹配的设备名称和端口，使我们能够更轻松地确定并解决问题。
    ![11-双工不匹配Full.png](/assets/images/cisco1/11-双工不匹配Full.png)
    ![11-双工不匹配half.png](/assets/images/cisco1/11-双工不匹配half.png)

3. IOS 设备的 IP 寻址问题
  与 IP 地址相关的问题可能会阻止远程网络设备进行通信。由于 IP 地址是分层的，分配给网络设备的任何 IP 地址都必须符合该网络地址范围。错误分配的 IP 地址会导致很多问题，包括 IP 地址冲突和路由问题。

  IPv4 分配不正确的两个常见原因是手动分配错误或与 DHCP 相关的问题。

  在 IOS 设备上，请使用 `show ip interface` 或 `show ip interface brief` 命令验证哪些 IPv4 地址分配给了网络接口。 `show interfaces` 命令显示接口的物理和数据链路详细信息。

4. 默认网关问题

  终端设备的默认网关是可以将流量转发到其他网络的最近的网络设备。如果设备的默认网关地址不正确或不存在，它将无法与远程网络中的设备通信。由于默认网关是通向远程网络的路径，其地址必须与终端设备属于同一网络。

  要解决默认网关配置错误问题，请确保为设备配置正确的默认网关。如果手动设置的默认地址不正确，只需将其替换为合适的地址即可。如果默认网关地址是自动设置的，请确保设备可以与 DHCP 服务器正常通信。还必须验证路由器接口上的 IPv4 地址和子网掩码是否配置适当，以及该接口是否处于活动状态。

  要验证基于 Windows 的计算机上的默认网关，请使用 ipconfig 命令。

  在路由器上，使用 show ip route 命令列出路由表，并验证称为默认路由的默认网关是否已设置。当数据包的目的地址与路由表中任何其他路由不匹配时，使用此路由。

5. 排除 DNS 故障

  域名服务 (DNS) 定义了一种将域名（例如 www.cisco.com）与 IP 地址相匹配的自动化服务。DNS 解析对于设备无关紧要，但对最终用户而言非常重要。

  用户通常会错误地将互联网链路的运行与 DNS 服务的可用性相关联。“网络中断”或“互联网中断”等用户投诉通常就是由于 DNS 服务器无法访问所导致的。当数据包路由以及其他网络服务仍正常运行时，DNS 故障经常会导致用户得出错误结论。如果用户在 Web 浏览器中键入一个域名（例如 www.cisco.com），而 DNS 服务器无法访问，则该域名将无法转换为 IP 地址，网站将不会显示。

  任何可访问的 DNS 服务器都可以用于解析域名。小型办公室和家庭办公室 (SOHO) 用户通常依赖其 ISP 所维护的 DNS 服务器来进行域名解析。ISP 维护的 DNS 服务器通过 DHCP 分配给 SOHO 客户。例如，Google 维护一个可供所有人使用的公共 DNS 服务器，它对于测试非常有用。Google 的公共 DNS 服务器的 IPv4 地址为 8.8.8.8，其 IPv6 DNS 地址为 2001:4860:4860::8888。

  nslookup 命令是 PC 的另一个有用的 DNS 故障排除工具。利用 nslookup，用户可以手动进行 DNS 查询并分析 DNS 响应。
